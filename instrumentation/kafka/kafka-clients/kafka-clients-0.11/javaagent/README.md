# Background on instrumentation

This module adds kafka messages payloads to the spans generated by the upstream [Kafka client instrumentation](https://github.com/open-telemetry/opentelemetry-java-instrumentation/tree/main/instrumentation/kafka/kafka-clients/kafka-clients-0.11/javaagent).

## How it works

We utilize two instrumentation modules because one needs to run before the OTEL instrumentation and the other after.

### Adding Producer instrumentation payloads

Similar to the Otel producer instrumentation, we instrument the `send` method of `KafkaProducer` class.
Then run after the Otel intrumentation and add the payload to the span attributes.

### Adding Consumer instrumentation payloads

The OTEL consumer instrumentation creates consume spans only when the user iterates over the records.
It does this by wrapping the iterator of the ConsumerRecords class.
Our payload instrumentation works similarly by wrapping the OTEL iterator with our own iterator, 
and then adding the payloads to the span attributes generated when the user iterates over the records.

## Maintenance

No special maintenance is required for this module.
